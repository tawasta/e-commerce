<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <template id="billing_address_assets" name="Billing address assets">
        <script
            type="text/javascript"
            src="/website_sale_billing_address/static/src/js/address.js"
        />
    </template>
    <template
        id="address"
        inherit_id="website_sale.address"
        name="Billing address"
        customize_show="True"
        active="True">
        <xpath expr="//div[@class='w-100'][last()]" position="after">
            <div class="col-12" t-if="mode != ('new', 'shipping')">
                <label>
                    <input
                        type="checkbox"
                        id='billing_use_same'
                        class="mr8"
                        name='billing_use_same'
                        value="1"
                        checked='checked'
                    />Same billing address
                    <span
                        class='billing_to_other text-muted'
                        style="display: none">&amp;nbsp;(<i>Your billing address will be requested later) </i></span>
                </label>
            </div>
            <t
                t-call-assets="website_sale_billing_address.billing_address_assets"
                lazy_load="True"
            />
        </xpath>
    </template>

    <template id="checkout" inherit_id="website_sale.checkout">
        <xpath
            expr="//div[@class='col-12 col-xl order-xl-1 oe_cart']/div[@class='row']"
            position="before">
            <div class="row">
                <div class="col-lg-12">
                    <h3 class="o_page_header mt8">Subscriber</h3>
                </div>
                <div class="col-lg-6 one_kanban_subscriber">
                <div
                        t-attf-class="card #{selected and 'border border-primary' or 'js_change_shipping'}">
                    <div class='card-body' style='min-height: 130px;'>
                    <a
                                t-attf-href="/shop/address?partner_id={{order.partner_id.id}}"
                                t-att-class="'btn btn-link float-right p-0 no-decoration'"
                                role="button"
                                title="Edit this address"
                                aria-label="Edit this address"><i
                                    class='fa fa-edit'
                                /></a>
                    <t
                                t-esc="order.partner_id"
                                t-options="dict(widget='contact', fields=['name', 'address'], no_marker=True)"
                            />
                </div>
                </div>
                </div>
            </div>
        </xpath>
        <xpath expr="//div[@class='col-lg-6 one_kanban']" position="before">
            <div class="col-md-12 col-lg-12 one_kanban">
                <form action="/shop/billing_address" method="post" class=''>
                    <input
                        type="hidden"
                        name="csrf_token"
                        t-att-value="request.csrf_token()"
                    />
                    <input type="hidden" name="new_billing_address" value="1" />
                    <a
                        role="button"
                        href="#"
                        class='a-submit btn btn-secondary mb16 btn-block'>
                        <i class="fa fa-plus-square" />
                        <span>Add another billing address</span>
                    </a>
                </form>
            </div>
        </xpath>
        <xpath expr="//div[@class='col-lg-6 one_kanban']" position="replace">
            <div class="col-lg-12 one_kanban row">
                <t t-foreach="billings" t-as="billing">
                    <div class="col-md-12 col-lg-6 one_kanban">
                        <t t-call="website_sale_billing_address.address_kanban">
                            <t t-set="actual_partner" t-value="order.partner_id" />
                            <t t-set='contact' t-value="billing" />
                            <t
                                t-set='selected'
                                t-value="order.partner_invoice_id==billing"
                            />
                            <t t-set='readonly' t-value="bool(len(billings)==1)" />
                            <t
                                t-set='edit_billing'
                                t-value="bool(billing!=order.partner_invoice_id)"
                            />
                        </t>
                    </div>
                </t>
            </div>
        </xpath>
    </template>

    <template id="address_kanban" name="Kanban address">
            <div
            t-attf-class="card #{selected and 'border border-primary' or 'js_change_shipping'}">
                <div class='card-body' style='min-height: 130px;'>
                    <a
                    t-attf-href="/shop/billing_address/{{contact.id}}"
                    t-att-class="'btn btn-link float-right p-0 no-decoration'"
                    role="button"
                    title="Edit this address"
                    aria-label="Edit this address"><i class='fa fa-edit' /></a>
                    <t
                    t-esc="contact"
                    t-options="dict(widget='contact', fields=['name', 'address'], no_marker=True)"
                />
                </div>
                <div class='card-footer' t-if='not readonly'>
                    <span
                    class='btn-billing'
                    t-att-style="'' if selected else 'display:none;'">
                        <a role="button" href='#' class="btn btn-block btn-primary">
                            <i class='fa fa-check' /> Billing to this address
                        </a>
                    </span>
                    <span
                    class='btn-billing'
                    t-att-style="'' if not selected else 'display:none;'">
                        <form action="/shop/change/billing_address" method="POST">
                            <input
                            type="hidden"
                            name="csrf_token"
                            t-att-value="request.csrf_token()"
                        />
                            <input
                            type="hidden"
                            name="partner_id"
                            t-att-value="contact.id"
                        />
                            <t t-if='edit_billing'>
                                <input
                                type="hidden"
                                name="return_url"
                                t-att-value="request.httprequest.path"
                            />
                                <input
                                type="hidden"
                                name="user_billing_address"
                                value="True"
                            />
                            </t>
                            <button
                            class="btn btn-block btn-secondary"
                            type="submit">Select this address</button>
                        </form>

                    </span>
                </div>
            </div>
    </template>

    <template id="billing_assets" name="Billing assets">
        <script
            type="text/javascript"
            src="/website_sale_billing_address/static/src/js/billing.js"
        />
    </template>

    <template id="billing_address" name="billing_address">
        <t t-call="website.layout">
            <t
                t-call-assets="website_sale_billing_address.billing_assets"
                lazy_load="True"
            />
            <t t-set="no_footer" t-value="1" />
            <div id="wrap">
                <div class="container oe_website_sale py-2">
                    <div class="row">
                        <div class="col-12">
                            <t t-call="website_sale.wizard_checkout">
                                <t t-set="step" t-value="25" />
                            </t>
                        </div>
                        <div class="col-12 col-xl-auto order-xl-2 d-none d-xl-block">
                            <t t-call="website_sale.cart_summary">
                                <t t-set="redirect" t-valuef="/shop/billing_address" />
                            </t>
                        </div>
                        <div class="col-12 col-xl order-xl-1 oe_cart">
                            <h2 class="o_page_header mt8">Billing Address</h2>
                            <form
                                action="/shop/billing_address"
                                method="post"
                                class="checkout_autoformat">
                                <div class="form-row">
                                    <div class="form-group col-lg-6 div_firstname">
                                        <label
                                            class="col-form-label"
                                            for="firstname">Firstname</label>
                                        <t t-if="partner">
                                            <input
                                                type="text"
                                                name="firstname"
                                                required="1"
                                                class="form-control"
                                                t-att-value="partner.firstname"
                                            />
                                        </t>
                                        <t t-else="">
                                            <input
                                                type="text"
                                                name="firstname"
                                                required="1"
                                                class="form-control"
                                            />
                                        </t>
                                    </div>
                                    <div class="form-group col-lg-6 div_lastname">
                                        <label
                                            class="col-form-label"
                                            for="lastname">Lastname</label>
                                        <t t-if="partner">
                                            <input
                                                type="text"
                                                name="lastname"
                                                class="form-control"
                                                required="1"
                                                t-att-value="partner.lastname"
                                            />
                                        </t>
                                        <t t-else="">
                                            <input
                                                type="text"
                                                name="lastname"
                                                required="1"
                                                class="form-control"
                                            />
                                        </t>
                                    </div>
                                    <div class="form-group col-lg-6" id="div_email">
                                        <label
                                            class="col-form-label"
                                            for="email">Email</label>
                                        <t t-if="partner">
                                            <input
                                                type="email"
                                                name="email"
                                                id="email_input"
                                                class="form-control"
                                                required="1"
                                                t-att-value="partner.email"
                                            />
                                        </t>
                                        <t t-else="">
                                            <input
                                                type="email"
                                                id="email_input"
                                                name="email"
                                                class="form-control"
                                                required="1"
                                            />
                                        </t>
                                    </div>
                                    <div class="form-group col-lg-6" id="div_phone">
                                        <label
                                            class="col-form-label"
                                            for="phone">Phone</label>
                                        <t t-if="partner">
                                            <input
                                                type="tel"
                                                name="phone"
                                                required="1"
                                                class="form-control"
                                                t-att-value="partner.phone"
                                            />
                                        </t>
                                        <t t-else="">
                                            <input
                                                type="tel"
                                                name="phone"
                                                required="1"
                                                class="form-control"
                                            />
                                        </t>
                                    </div>

                                    <div class="form-group col-lg-6 div_company_name">
                                        <label
                                            class="col-form-label font-weight-normal label-optional"
                                            for="company_name">Company name</label>
                                        <t t-if="partner and partner.parent_id">
                                            <input
                                                type="text"
                                                name="company_name"
                                                class="form-control"
                                                t-att-value="partner.parent_id.name"
                                            />
                                        </t>
                                        <t t-else="">
                                            <input
                                                type="text"
                                                name="company_name"
                                                class="form-control"
                                            />
                                        </t>
                                    </div>
                                    <div class="form-group col-lg-6 div_company_email">
                                        <label
                                            class="col-form-label font-weight-normal label-optional"
                                            for="company_email">Company email</label>
                                        <t t-if="partner and partner.parent_id">
                                            <input
                                                type="text"
                                                name="company_email"
                                                class="form-control"
                                                t-att-value="partner.parent_id.email"
                                            />
                                        </t>
                                        <t t-else="">
                                            <input
                                                type="text"
                                                name="company_email"
                                                class="form-control"
                                            />
                                        </t>
                                    </div>
                                    <div class="form-group col-lg-6 div_vat">
                                        <label
                                            class="col-form-label font-weight-normal label-optional"
                                            for="vat">TIN / VAT </label>
                                        <t t-if="partner and partner.parent_id">
                                            <input
                                                type="text"
                                                name="vat"
                                                class="form-control"
                                                t-att-value="partner.parent_id.vat"
                                            />
                                        </t>
                                        <t t-else="">
                                            <input
                                                type="text"
                                                name="vat"
                                                class="form-control"
                                            />
                                        </t>
                                    </div>

                                    <div
                                        id="customer_invoice_transmit_method_id_div"
                                        class="form-group col-lg-6 show-company">
                                        <t
                                            t-set="methods"
                                            t-value="request.env['transmit.method'].sudo().search([('customer_ok', '=', True)])"
                                        />
                                        <label
                                            class="col-form-label"
                                            for="customer_invoice_transmit_method_id">Invoice transmit method</label>
                                        <t t-if="partner">
                                            <select
                                                id="customer-invoice-transmit-method"
                                                class="form-control"
                                                required="1"
                                                name="customer_invoice_transmit_method_id"
                                                data-init="1">
                                                <t t-foreach="methods" t-as="method">
                                                    <option
                                                        t-att-value="method.id"
                                                        t-att-data-code="method.code"
                                                        t-att-selected="method.id == partner.parent_id.customer_invoice_transmit_method_id.id"
                                                        t-esc="method.name"
                                                    />
                                                </t>
                                            </select>
                                        </t>
                                        <t t-else="">
                                            <select
                                                id="customer-invoice-transmit-method"
                                                class="form-control"
                                                required="1"
                                                name="customer_invoice_transmit_method_id"
                                                data-init="1">
                                                <t t-foreach="methods" t-as="method">
                                                    <option
                                                        t-att-value="method.id"
                                                        t-att-data-code="method.code"
                                                        t-esc="method.name"
                                                    />
                                                </t>
                                            </select>
                                        </t>
                                    </div>

                                    <div
                                        id="edicode-div"
                                        class="form-group col-md-6 div_edicode show-company">
                                        <label
                                            class="col-form-label label-optional"
                                            for="edicode">Edicode</label>
                                        <t t-if="partner and partner.parent_id">
                                            <input
                                                type="text"
                                                name="edicode"
                                                class="form-control"
                                                t-att-value="partner.parent_id.edicode"
                                            />
                                        </t>
                                        <t t-else="">
                                            <input
                                                type="text"
                                                name="edicode"
                                                class="form-control"
                                            />
                                        </t>
                                    </div>
                                    <div
                                        id="einvoice-operator-div"
                                        class="form-group col-lg-6 div_einvoice_operator show-company">
                                        <t
                                            t-set="operators"
                                            t-value="request.env['res.partner.operator.einvoice'].sudo().search([])"
                                        />
                                        <label
                                            class="col-form-label label-optional"
                                            for="einvoice_operator_id">eInvoice Operator</label>
                                        <t t-if="partner and partner.parent_id">
                                            <select
                                                id="einvoice-operator-select"
                                                class="form-control einvoice_operator-select select2"
                                                name="einvoice_operator_id">
                                                <option />
                                                <t t-foreach="operators" t-as="op">
                                                    <option
                                                        t-att-value="op.id"
                                                        t-att-selected="op.id == partner.parent_id.einvoice_operator_id
                                                        .id"><span
                                                            t-esc="op.name"
                                                        /> (<span
                                                            t-esc="op.identifier"
                                                        />)
                                                    </option>
                                                </t>
                                            </select>
                                        </t>
                                        <t t-else="">
                                            <select
                                                id="einvoice-operator-select"
                                                class="form-control einvoice_operator-select select2"
                                                name="einvoice_operator_id">
                                                <option />
                                                <t t-foreach="operators" t-as="op">
                                                    <option t-att-value="op.id"><span
                                                            t-esc="op.name"
                                                        /> (<span
                                                            t-esc="op.identifier"
                                                        />)
                                                    </option>
                                                </t>
                                            </select>
                                        </t>
                                    </div>




                                    <div class="w-100" />
                                    <div class="form-group col-lg-12 div_street">
                                        <label
                                            class="col-form-label"
                                            for="street">Street <span
                                                class="d-none d-md-inline"> and Number</span></label>
                                        <t t-if="partner">
                                            <input
                                                type="text"
                                                name="street"
                                                required="1"
                                                class="form-control"
                                                t-att-value="partner.street"
                                            />
                                        </t>
                                        <t t-else="">
                                            <input
                                                type="text"
                                                name="street"
                                                required="1"
                                                class="form-control"
                                            />
                                        </t>
                                    </div>
                                    <div class="form-group col-lg-12 div_street2">
                                        <label
                                            class="col-form-label label-optional"
                                            for="street2">Street 2</label>
                                        <t t-if="partner">
                                            <input
                                                type="text"
                                                name="street2"
                                                class="form-control"
                                                t-att-value="partner.street2"
                                            />
                                        </t>
                                        <t t-else="">
                                            <input
                                                type="text"
                                                name="street2"
                                                class="form-control"
                                            />
                                        </t>
                                    </div>
                                    <div class="w-100" />
                                    <t
                                        t-set='zip_city'
                                        t-value='country and [x for x in country.get_address_fields() if x in ["zip", "city"]] or ["city", "zip"]'
                                    />
                                    <t
                                        t-if="'zip' in zip_city and zip_city.index('zip') &lt; zip_city.index('city')">
                                        <div class="form-group col-md-4 div_zip">
                                            <label
                                                class="col-form-label label-optional"
                                                for="zip">Zip Code</label>
                                            <t t-if="partner">
                                                <input
                                                    type="text"
                                                    name="zip"
                                                    class="form-control"
                                                    t-att-value="partner.zip"
                                                />
                                            </t>
                                            <t t-else="">
                                                <input
                                                    type="text"
                                                    name="zip"
                                                    class="form-control"
                                                />
                                            </t>
                                        </div>
                                    </t>

                                    <t
                                        t-if="'zip' in zip_city and zip_city.index('zip') &gt; zip_city.index('city')">
                                        <div class="form-group col-md-4 div_zip">
                                            <label
                                                class="col-form-label label-optional"
                                                for="zip">Zip Code</label>
                                            <t t-if="partner">
                                                <input
                                                    type="text"
                                                    name="zip"
                                                    class="form-control"
                                                    t-att-value="partner.zip"
                                                />
                                            </t>
                                            <t t-else="">
                                                <input
                                                    type="text"
                                                    name="zip"
                                                    class="form-control"
                                                />
                                            </t>
                                        </div>
                                    </t>
                                    <div class="form-group col-md-8 div_city">
                                        <label
                                            class="col-form-label"
                                            for="city">City</label>
                                        <t t-if="partner">
                                            <input
                                                type="text"
                                                name="city"
                                                required="1"
                                                class="form-control"
                                                t-att-value="partner.city"
                                            />
                                        </t>
                                        <t t-else="">
                                            <input
                                                type="text"
                                                name="city"
                                                required="1"
                                                class="form-control"
                                            />
                                        </t>
                                    </div>
                                    <div class="w-100" />
                                    <div t-attf-class="form-group col-lg-6 div_c_id">
                                        <label
                                            class="col-form-label"
                                            for="c_id">Country</label>
                                        <t t-if="partner">
                                            <select
                                                id="c_id"
                                                name="c_id"
                                                class="form-control">
                                                <option value="">Country...</option>
                                                <t t-foreach="countries" t-as="c">
                                                    <option
                                                        t-att-value="c.id"
                                                        t-att-selected="c.id == partner.country_id.id">
                                                        <t t-esc="c.name" />
                                                    </option>
                                                </t>
                                            </select>
                                        </t>
                                        <t t-else="">
                                            <select
                                                id="c_id"
                                                name="c_id"
                                                class="form-control">
                                                <option value="">Country...</option>
                                                <t t-foreach="countries" t-as="c">
                                                     <option
                                                        t-att-selected="c.id == request.env.ref('base.fi').id"
                                                        t-att-value="c.id"><t
                                                            t-esc="c.name"
                                                        /></option>
                                                </t>
                                            </select>
                                        </t>
                                    </div>
                                </div>

                                <input
                                    type="hidden"
                                    name="csrf_token"
                                    t-att-value="request.csrf_token()"
                                />
                                <input type="hidden" name="submitted" value="1" />
                                <t t-if="partner">
                                    <input
                                        type="hidden"
                                        name="partner_id"
                                        t-att-value="partner.id or '0'"
                                    />
                                    <t t-set="back_href" t-value="'/shop/checkout'" />
                                </t>
                                <t t-else="">
                                    <input
                                        type="hidden"
                                        name="partner_id"
                                        t-att-value="partner or '0'"
                                    />
                                    <t t-set="back_href" t-value="'/shop/address'" />
                                </t>
                                <t t-if="partner and partner.parent_id">
                                    <input
                                        type="hidden"
                                        name="company_id"
                                        t-att-value="partner.parent_id.id"
                                    />
                                </t>
                                <t t-if="partner">
                                    <input type="hidden" name="editing" value="1" />
                                </t>

                                <div class="d-flex justify-content-between">
                                    <a
                                        role="button"
                                        t-att-href="back_href"
                                        class="btn btn-secondary mb32">
                                        <i class="fa fa-chevron-left" />
                                        <span>Back</span>
                                    </a>
                                    <button
                                        class="btn btn-primary mb32"
                                        id="billing_address_confirm_btn"
                                        type="submit"><span>Next</span>
                                        <i class="fa fa-chevron-right" /></button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

</odoo>
