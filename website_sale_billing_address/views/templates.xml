<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <template
        id="address"
        inherit_id="website_sale.address"
        name="Billing address"
        customize_show="True"
        active="True"
    >
        <!-- Hide "Billing address" from first address view -->
        <xpath
            expr="//t[@t-if='is_public_order']/following-sibling::t/h3"
            position="attributes"
        >
            <attribute
                name="t-attf-class"
            >{{'mb-3 asd' if website_sale_order.use_different_billing_address else 'd-none' }}</attribute>
        </xpath>

        <xpath
            expr="//t[@t-if=&quot;mode == ('new', 'billing') and not only_services&quot;]"
            position="after"
        >
            <div class="col-12" t-if="mode != ('new', 'shipping')">

                <div class="form-check form-switch mt-2 mb-3">
                    <label>
                        <input
                            type="checkbox"
                            id='billing_use_same'
                            class="form-check-input mr8"
                            name='billing_use_same'
                            value="1"
                            checked='checked'
                        />Same billing address
                        <span
                            t-if="is_public_user"
                            class='billing_to_other text-muted'
                            style="display: none"
                        >&amp;nbsp;(
                            <i>Your billing address will be requested later)
                            </i>
                        </span>
                    </label>
                </div>
            </div>
        </xpath>
        <xpath expr="//input[@name='name']/.." position="after">

            <div
                t-attf-class="#{error.get('vat') and 'o_has_error'} div_vat col-lg-6 mb-2"
                t-if="is_billing_mode"
            >
                                                    <label
                    class="col-form-label fw-normal label-optional"
                    for="vat"
                >VAT</label>
                                                    <input
                    type="text"
                    name="vat"
                    t-attf-class="form-control #{error.get('vat') and 'is-invalid' or ''}"
                    t-att-value="'vat' in checkout and checkout['vat']"
                    t-att-readonly="'1' if vat_warning else None"
                />
                                                    <small
                    t-if="vat_warning"
                    class="form-text text-muted d-block d-lg-none"
                >Changing VAT number is not allowed once document(s) have been issued for your account. Please contact us directly for this operation.</small>
                                                </div>
            <t
                t-set="methods"
                t-value="request.env['transmit.method'].sudo().search([('website_sale_ok', '=', True)])"
            />
            <div
                id="customer_invoice_transmit_method_id_div"
                t-attf-class="form-group #{error.get('customer_invoice_transmit_method_id') and 'has-error' or ''} col-lg-6"
                t-if="is_billing_mode and methods"
            >
                <label
                    class="col-form-label"
                    for="customer_invoice_transmit_method_id"
                >Invoice transmit method</label>
                <select
                    id="customer-invoice-transmit-method"
                    t-attf-class="form-control #{error.get('customer_invoice_transmit_method_id') and 'is-invalid' or ''}"
                    name="customer_invoice_transmit_method_id"
                    data-init="1"
                >
                    <t t-foreach="methods" t-as="method">
                        <option
                            t-att-value="method.id"
                            t-att-data-code="method.code"
                            t-att-selected="method.id == ('customer_invoice_transmit_method_id' in checkout and checkout['customer_invoice_transmit_method_id'] != '' and int(checkout['customer_invoice_transmit_method_id']))"
                            t-esc="method.name"
                        />
                    </t>
                </select>
            </div>
            <input type="hidden" name="billing_address" t-att-value="is_billing_mode" />
        </xpath>
    </template>

    <template id="checkout" inherit_id="website_sale.checkout">
        <xpath expr="//div[@class='col-lg-12']/h4" position="attributes">
            <attribute name="class" position="add" separator=" ">d-none</attribute>
        </xpath>
        <xpath expr="//t[@t-call='website_sale.row_addresses']" position="before">
            <div class="row">
                <div class="col-lg-12">
                    <h4 class="">Subscriber</h4>
                </div>
                <div class="col-lg-6 one_kanban_subscriber">
                    <div
                        t-attf-class="card #{selected and 'border border-primary' or 'js_change_shipping'}"
                    >
                        <div class='card-body' style='min-height: 130px;'>
                            <a
                                t-if="not actual_partner or (billing.id in actual_partner.child_ids.ids)"
                                t-attf-href="/shop/address?partner_id={{order.partner_id.id}}"
                                t-att-class="'btn btn-link float-right p-0 no-decoration'"
                                role="button"
                                title="Edit this address"
                                aria-label="Edit this address"
                            >
                                <i class='fa fa-edit' />
                            </a>
                            <t
                                t-esc="order.partner_id"
                                t-options="dict(widget='contact', fields=['name', 'address'], no_marker=True)"
                            />
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-12">
                <h4>Billing</h4>
            </div>
        </xpath>
    </template>

    <template id="row_addresses_inherit" inherit_id="website_sale.row_addresses">
        <xpath
            expr="//div[contains(@class, 'one_kanban') and contains(@class, 'col-md') and @t-if]"
            position="after"
        >
            <div
                class="one_kanban col-md"
                t-if="order.website_id.is_public_user() and is_invoice"
            >
                <t t-if="is_invoice">
                    <t t-set="new_address_href" t-valuef="/shop/address?mode=billing" />
                </t>
                <a
                    role="button"
                    t-att-href="new_address_href"
                    class="o_wsale_add_address d-flex align-items-center justify-content-center h-100 px-4 border rounded mx-auto no-decoration"
                >
                    <i class="fa fa-plus me-md-2" /><span
                        class="d-none d-md-inline"
                    >Add address</span>
                </a>
            </div>
        </xpath>
    </template>

</odoo>
