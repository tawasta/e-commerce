<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <template id="address_hide_domicile" inherit_id="website_sale_domicile.address">
        <xpath expr="//div[@id='domicile_div']" position="attributes">
            <attribute name="t-if">not is_billing_mode</attribute>
        </xpath>
    </template>

    <template
        id="address"
        inherit_id="website_sale.address"
        name="Billing address"
        customize_show="True"
        active="True"
    >
        <xpath expr="//input[@name='name']/.." position="after">
            <input type="hidden" name="billing_address" t-att-value="is_billing_mode" />
        </xpath>
        <xpath expr="//input[@name='phone']/.." position="after">
            <div
                t-attf-class="form-group #{error.get('company_email') and 'o_has_error' or ''} col-lg-6"
                id="company_email"
                t-if="is_billing_mode"
            >
                <label
                    id="company-email-label"
                    class="col-form-label font-weight-normal label-optional"
                    for="company_email"
                >Invoice Email</label>
                <input
                    type="text"
                    id="company-email-input"
                    name="company_email_billing"
                    t-attf-class="form-control #{error.get('company_email') and 'is-invalid' or ''}"
                    t-att-value="'company_email' in checkout and checkout['company_email']"
                    t-att-readonly="'1' if 'vat' in checkout and checkout['vat'] and not can_edit_vat else None"
                    t-att-title="company_email if 'vat' in checkout and checkout['vat'] and not can_edit_vat else None"
                />
            </div>
            <div
                class="div_company_registry_billing col-lg-6 mb-2"
                t-if="is_billing_mode"
            >
                <label
                    class="col-form-label fw-normal label-optional"
                    for="company_registry"
                >VAT</label>
                <input
                    type="text"
                    name="billing_company_registry"
                    class="form-control"
                    t-att-value="'company_registry' in checkout and checkout['company_registry']"
                />
            </div>
            <t
                t-set="methods"
                t-value="request.env['transmit.method'].sudo().search([('website_sale_ok', '=', True)])"
            />
            <div
                id="customer_invoice_transmit_method_id_div_billing"
                t-attf-class="form-group #{error.get('customer_invoice_transmit_method_id') and 'has-error' or ''} col-lg-6"
                t-if="methods and is_billing_mode"
            >
                <label
                    class="col-form-label"
                    for="customer_invoice_transmit_method_id"
                >Invoice transmit method</label>
                <select
                    id="customer-invoice-transmit-method-billing"
                    t-attf-class="form-control #{error.get('customer_invoice_transmit_method_id') and 'is-invalid' or ''}"
                    name="customer_invoice_transmit_method_id"
                    data-init="1"
                >
                    <t t-foreach="methods" t-as="method">
                        <option
                            t-att-value="method.id"
                            t-att-data-code="method.code"
                            t-att-selected="method.id == ('customer_invoice_transmit_method_id' in checkout and checkout['customer_invoice_transmit_method_id'] != '' and int(checkout['customer_invoice_transmit_method_id']))"
                            t-esc="method.name"
                        />
                    </t>
                </select>
            </div>
            <div
                id="edicode-div"
                t-attf-class="form-group #{error.get('edicode') and 'has-error' or ''} col-md-6 div_edicode"
            >
                    <label
                    id="edicode-label"
                    class="col-form-label label-optional"
                    for="edicode"
                >eInvoice address (EDI-code)</label>
                    <input
                    type="text"
                    name="edicode"
                    class="form-control"
                    t-att-value="'edicode' in checkout and checkout['edicode']"
                />
                </div>
                <div
                id="einvoice-operator-div"
                t-attf-class="form-group #{error.get('einvoice_operator_id') and 'has-error' or ''} col-lg-6 div_einvoice_operator"
            >
                    <t
                    t-set="operators"
                    t-value="request.env['res.partner.operator.einvoice'].sudo().search([])"
                />
                    <label
                    id="einvoice-operator-label"
                    class="col-form-label label-optional"
                    for="einvoice_operator_id"
                >eInvoice Operator</label>
                    <select
                    id="einvoice-operator-select"
                    t-attf-class="form-control #{error.get('einvoice_operator_id') and 'is-invalid' or ''}"
                    name="einvoice_operator_id"
                >
                        <option />
                        <t t-foreach="operators" t-as="op">
                            <option
                            t-att-value="op.id"
                            t-att-selected="op.id == ('einvoice_operator_id' in checkout and checkout['einvoice_operator_id'] != '' and int(checkout['einvoice_operator_id']))"
                        >
                                <span t-esc="op.name" /> (<span
                                t-esc="op.identifier"
                            />)
                            </option>
                        </t>
                    </select>
                </div>
        </xpath>
    </template>

    <template id="checkout" inherit_id="website_sale.checkout">
        <xpath expr="//div[@class='col-lg-12']/h4" position="attributes">
            <attribute name="class" position="add" separator=" ">d-none</attribute>
        </xpath>
        <xpath expr="//t[@t-call='website_sale.row_addresses']" position="before">
            <div class="row">
                <div class="col-lg-12">
                    <h4 class="">Subscriber</h4>
                </div>
                <div class="col-lg-6 one_kanban_subscriber">
                    <div
                        t-attf-class="card #{selected and 'border border-primary' or 'js_change_shipping'}"
                    >
                        <div class='card-body' style='min-height: 130px;'>
                            <a
                                t-if="not actual_partner or (billing.id in actual_partner.child_ids.ids)"
                                t-attf-href="/shop/address?partner_id={{order.partner_id.id}}"
                                t-att-class="'btn btn-link float-right p-0 no-decoration'"
                                role="button"
                                title="Edit this address"
                                aria-label="Edit this address"
                            >
                                <i class='fa fa-edit' />
                            </a>
                            <t
                                t-esc="order.partner_id"
                                t-options="dict(widget='contact', fields=['name', 'address'], no_marker=True)"
                            />
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-12">
                <h4>Billing</h4>
            </div>
        </xpath>
    </template>

    <template id="row_addresses_inherit" inherit_id="website_sale.row_addresses">
        <xpath
            expr="//div[contains(@class, 'one_kanban') and contains(@class, 'col-md') and @t-if]"
            position="after"
        >
            <div
                class="one_kanban col-md"
                t-if="order.website_id.is_public_user() and is_invoice"
            >
                <t t-if="is_invoice">
                    <t t-set="new_address_href" t-valuef="/shop/address?mode=billing" />
                </t>
                <a
                    role="button"
                    t-att-href="new_address_href"
                    class="o_wsale_add_address d-flex align-items-center justify-content-center h-100 px-4 border rounded mx-auto no-decoration"
                >
                    <i class="fa fa-plus me-md-2" /><span
                        class="d-none d-md-inline"
                    >Add address</span>
                </a>
            </div>
        </xpath>
    </template>

</odoo>
